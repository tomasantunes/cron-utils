<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Cron Form</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <!-- Correct UMD Croner build -->
        <script src="https://unpkg.com/croner@4.4.0/dist/croner.min.js"></script>
    </head>
    <body class="bg-light p-4">
        <div class="container">
            <h1 class="mb-4">Cron Form</h1>

            <div class="card mb-4">
                <div class="card-header">Presets</div>
                <div class="card-body">
                    <select class="form-select" id="preset">
                        <option value="">Select preset...</option>
                        <option value="* * * * *">Every minute</option>
                        <option value="0 * * * *">Hourly</option>
                        <option value="0 0 * * *">Daily</option>
                        <option value="0 0 * * 0">Weekly</option>
                        <option value="0 0 */14 * *">Bi-weekly</option>
                        <option value="0 0 1 * *">Monthly</option>
                        <option value="0 0 1 */3 *">Every 3 months</option>
                        <option value="0 0 1 */6 *">Every 6 months</option>
                        <option value="0 0 1 1 *">Yearly</option>
                    </select>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">Custom Cron Builder</div>
                <div class="card-body row g-4">
                    <div class="col-md-2">
                        <label class="form-label">Minute</label>
                        <select id="m" class="form-select" multiple size="6"></select>
                        <input id="m_step" class="form-control mt-2" placeholder="Step e.g. */5" />
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Hour</label>
                        <select id="h" class="form-select" multiple size="6"></select>
                        <input id="h_step" class="form-control mt-2" placeholder="Step e.g. */2" />
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Day</label>
                        <select id="dom" class="form-select" multiple size="6"></select>
                        <input id="dom_step" class="form-control mt-2" placeholder="Step e.g. */3" />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Month</label>
                        <select id="mon" class="form-select" multiple size="6"></select>
                        <input id="mon_step" class="form-control mt-2" placeholder="Step e.g. */2" />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Day of Week</label>
                        <select id="dow" class="form-select" multiple size="6"></select>
                        <input id="dow_step" class="form-control mt-2" placeholder="Step e.g. */1" />
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">Specific Date & Time</div>
                <div class="card-body row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Date</label>
                        <input type="date" id="date" class="form-control" />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Time</label>
                        <input type="time" id="time" class="form-control" />
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <button class="btn btn-secondary w-100" id="useDate">Use Specific Date/Time</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Generated Cron</div>
                <div class="card-body">
                    <input id="output" class="form-control mb-3" readonly />
                    <button class="btn btn-primary" id="validate">Validate</button>
                    <div id="validation" class="mt-3"></div>
                </div>
            </div>
        </div>

        <script>
            function populateSelect(id, items) {
                const sel = $(id);
                sel.empty();
                sel.append(`<option value="*">ALL</option>`);
                for (const [value, label] of items) {
                    sel.append(`<option value="${value}">${label}</option>`);
                }
            }

            $(function () {
                populateSelect(
                    "#m",
                    Array.from({ length: 60 }, (_, i) => [i, i]),
                );
                populateSelect(
                    "#h",
                    Array.from({ length: 24 }, (_, i) => [i, i]),
                );
                populateSelect(
                    "#dom",
                    Array.from({ length: 31 }, (_, i) => [i + 1, i + 1]),
                );
                populateSelect("#mon", [
                    [1, "January"],
                    [2, "February"],
                    [3, "March"],
                    [4, "April"],
                    [5, "May"],
                    [6, "June"],
                    [7, "July"],
                    [8, "August"],
                    [9, "September"],
                    [10, "October"],
                    [11, "November"],
                    [12, "December"],
                ]);
                populateSelect("#dow", [
                    [0, "Sunday"],
                    [1, "Monday"],
                    [2, "Tuesday"],
                    [3, "Wednesday"],
                    [4, "Thursday"],
                    [5, "Friday"],
                    [6, "Saturday"],
                ]);
            });

            function getSelectCron(id, stepId) {
                const step = $(stepId).val();
                const vals = $(id).val();
                if (step) return step;
                if (!vals || vals.length === 0) return "*";
                if (vals.includes("*")) return "*";
                return vals.join(",");
            }

            function updateCron() {
                const cron = `${getSelectCron("#m", "#m_step")} ${getSelectCron("#h", "#h_step")} ${getSelectCron("#dom", "#dom_step")} ${getSelectCron("#mon", "#mon_step")} ${getSelectCron("#dow", "#dow_step")}`;
                $("#output").val(cron);
            }

            $("select").on("change", updateCron);

            $("#preset").on("change", function () {
                $("#output").val($(this).val());
            });

            $("#useDate").on("click", function () {
                const d = $("#date").val();
                const t = $("#time").val();
                if (!d || !t) return;
                const dt = new Date(`${d}T${t}:00`);
                $("#m").val([dt.getMinutes()]);
                $("#h").val([dt.getHours()]);
                $("#dom").val([dt.getDate()]);
                $("#mon").val([dt.getMonth() + 1]);
                $("#dow").val([dt.getDay()]);
                updateCron();
            });

            $("#validate").on("click", function () {
                const v = $("#output").val();
                try {
                    const c = new Cron(v); // create Cron object
                    const nextRun = c.next(); // get next occurrence
                    $("#validation").html(`<span class='text-success'>Valid cron. Next run: ${nextRun}</span>`);
                } catch (e) {
                    $("#validation").html(`<span class='text-danger'>Invalid cron: ${e.message}</span>`);
                }
            });
        </script>
    </body>
</html>
